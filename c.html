<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê¸¸ë‚˜í˜„ CPA ì˜¬ì¸ í˜ì´ì§€</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .sticker{box-shadow:0 8px 24px rgba(59,130,246,.25)}
    .wiggle{animation:wiggle 1.3s ease-in-out infinite}
    @keyframes wiggle{0%,100%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}}
    .tab-active{background:#3b82f6;color:#fff}
    .tab-inactive{background:#e6f0ff;color:#1d4ed8}
    .ghost{opacity:.6}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-50 to-indigo-50 text-slate-800">
  <!-- í—¤ë” -->
  <header class="max-w-5xl mx-auto px-4 pt-10 pb-4">
    <div class="flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-2xl bg-sky-400 text-white flex items-center justify-center text-2xl sticker">ğŸ’™</div>
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold text-sky-700">ê¸¸ë‚˜í˜„ CPA ì˜¬ì¸ í˜ì´ì§€</h1>
          <p class="text-sm text-slate-500">ì¬ì‹œëŠ” ì—†ë‹¤. ì¸ìƒì€ í•œ ë°©! Â· ì—°ì„¸ëŒ€ ì •ì™¸ íœ´í•™ Â· 2004.03.12</p>
        </div>
      </div>
      <!-- ì €ì¥ ëª¨ë“œ/ì„œë²„ ì£¼ì†Œ (ê³µìœ  ë°©ëª…ë¡ìš© ì˜µì…˜) -->
      <div class="text-sm flex items-center gap-2">
        <label>ì €ì¥ ëª¨ë“œ:
          <select id="modeSel" class="rounded-lg border border-slate-300 px-2 py-1">
            <option value="local">ë¡œì»¬</option>
            <option value="server">ì„œë²„</option>
          </select>
        </label>
        <label id="serverRow" class="ghost">ì„œë²„:
          <input id="serverUrl" placeholder="http://localhost:3000" class="rounded-lg border border-slate-300 px-2 py-1 w-44">
        </label>
      </div>
    </div>
  </header>

  <!-- ìƒë‹¨: D-Day / ë‚¨ì€ ë¹„ìœ¨ -->
  <section class="max-w-5xl mx-auto px-4">
    <div class="grid md:grid-cols-2 gap-6">
      <!-- ì¢Œ: ì‹œí—˜ íƒ€ì„ë¼ì¸ & D-Day -->
      <div class="bg-white/80 backdrop-blur rounded-2xl p-6 sticker">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold text-sky-700">ì‹œí—˜ íƒ€ì„ë¼ì¸ & D-Day</h2>
          <label class="inline-flex items-center gap-2 text-sm">
            <input id="passed1" type="checkbox" class="rounded border-slate-300 text-sky-600 focus:ring-sky-500">
            <span>1ì°¨ í•©ê²© ì²˜ë¦¬</span>
          </label>
        </div>

        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
          <!-- 1ì°¨ -->
          <div class="rounded-xl border border-sky-100 p-4 bg-sky-50">
            <div class="text-sm text-slate-500">CPA 1ì°¨</div>
            <div class="mt-1 text-lg font-semibold">2026-03-01</div>
            <div class="mt-2 flex items-end justify-between">
              <div class="text-sm text-slate-500">(KST ê¸°ì¤€)</div>
              <div class="text-2xl font-extrabold text-sky-700" id="dday1">D-â€”</div>
            </div>
            <div class="text-xs text-slate-500" id="left1">ë‚¨ì€: â€”ì¼</div>
          </div>

          <!-- 2ì°¨ -->
          <div class="rounded-xl border border-indigo-100 p-4 bg-indigo-50">
            <div class="text-sm text-slate-500">CPA 2ì°¨ (1ì°¨ í•©ê²© ì‹œ)</div>
            <div class="mt-1 text-lg font-semibold">2026-06-27â€“28</div>
            <div class="mt-2 flex items-end justify-between">
              <div class="text-sm text-slate-500">(KST ê¸°ì¤€)</div>
              <div class="text-2xl font-extrabold text-indigo-700" id="dday2">D-â€”</div>
            </div>
            <div class="text-xs text-slate-500" id="left2">ë‚¨ì€: â€”ì¼</div>
          </div>
        </div>

        <p class="mt-3 text-xs text-slate-500">â€» ìŠ¤ìœ„ì¹˜ë¥¼ ì¼œë©´ â€˜í™œì„± ì‹œí—˜â€™ì´ 2ì°¨ë¡œ ì „í™˜ë©ë‹ˆë‹¤.</p>
      </div>

      <!-- ìš°: ì›í˜• ë‚¨ì€ ë¹„ìœ¨ -->
      <div class="bg-white/80 backdrop-blur rounded-2xl p-6 sticker">
        <h2 class="text-xl font-bold text-sky-700">ë‚¨ì€ ë¹„ìœ¨ (100% = ì‹œí—˜ì¼ê¹Œì§€ ë‚¨ì€ ë¹„ì¤‘)</h2>
        <p class="text-sm text-slate-500">ì‹œì‘ ê¸°ì¤€ì¼ <span class="font-semibold">2024-03-01</span> â†’ í™œì„± ì‹œí—˜ì¼ê¹Œì§€ ë‚¨ì€ ë¹„ìœ¨.</p>

        <div class="mt-5 flex items-center gap-6">
          <svg width="170" height="170" viewBox="0 0 120 120" class="mx-auto">
            <defs>
              <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#3B82F6"/>
                <stop offset="100%" stop-color="#22D3EE"/>
              </linearGradient>
            </defs>
            <circle cx="60" cy="60" r="50" fill="none" stroke="#e5edff" stroke-width="12" />
            <circle id="progressArc" cx="60" cy="60" r="50" fill="none" stroke="url(#g1)" stroke-width="12" stroke-linecap="round" stroke-dasharray="0 999" transform="rotate(-90 60 60)" />
            <text id="percentText" x="60" y="54" text-anchor="middle" class="fill-slate-700" style="font:800 22px/1.15 ui-sans-serif,system-ui">--%</text>
            <text id="daysLeftText" x="60" y="78" text-anchor="middle" class="fill-slate-500" style="font:600 12px/1.1 ui-sans-serif,system-ui">ë‚¨ì€ 0ì¼</text>
          </svg>

          <div class="flex-1 text-sm">
            <div class="text-slate-600">ì‹œì‘ ê¸°ì¤€ì¼: <span class="font-semibold">2024-03-01</span> (ê³ ì •)</div>
            <div class="mt-1 text-slate-600">í™œì„± ì‹œí—˜: <span class="font-semibold" id="activeExamLabel">CPA 1ì°¨</span></div>
            <div class="mt-2 flex gap-2">
              <button id="refreshCheer" class="px-3 py-1.5 rounded-lg bg-sky-600 text-white text-xs font-semibold hover:bg-sky-700">ì˜¤ëŠ˜ì˜ ì‘ì› ìƒˆë¡œê³ ì¹¨</button>
              <button id="forceNewCheer" class="px-3 py-1.5 rounded-lg bg-indigo-600 text-white text-xs font-semibold hover:bg-indigo-700">ì˜¤ëŠ˜ ê²ƒ ë‹¤ì‹œ ë½‘ê¸°</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ì˜¤ëŠ˜ì˜ ì‘ì› -->
  <section class="max-w-5xl mx-auto px-4 mt-8">
    <div class="bg-white/80 backdrop-blur rounded-2xl p-6 sticker">
      <h2 class="text-xl font-bold text-sky-700">ì˜¤ëŠ˜ì˜ ì‘ì›</h2>
      <div id="cheerCard" class="mt-3 p-4 rounded-xl bg-sky-50 border border-sky-100 text-sky-800">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
    </div>
  </section>

  <!-- ë¡œë“œë§µ -->
  <section class="max-w-5xl mx-auto px-4 mt-8">
    <div class="bg-sky-600 text-white rounded-2xl p-6 sticker">
      <div class="grid sm:grid-cols-5 gap-3">
        <div class="bg-white/15 rounded-xl p-3 text-center">1) ë„ˆí¬ë“¤ê³¼ í•©ê²© íŒŒí‹° ğŸ‰</div>
        <div class="bg-white/15 rounded-xl p-3 text-center">2) ë¯¸êµ­ êµí™˜í•™ìƒ ğŸŒ</div>
        <div class="bg-white/15 rounded-xl p-3 text-center">3) ë„ˆí¬ì™€ ì¡¸ì—… ì—¬í–‰ âœˆï¸</div>
        <div class="bg-white/15 rounded-xl p-3 text-center">4) ì‚¼ì¼ íšŒê³„ë²•ì¸ ì…ì‚¬ ğŸ§¾</div>
        <div class="bg-white/15 rounded-xl p-3 text-center">5) íˆ¬ì ì„±ê³µ â†’ ë°±ë§Œì¥ì ğŸ’</div>
      </div>
    </div>
  </section>

  <!-- ì›¹ì‚¬ì´íŠ¸ íƒ­ -->
  <section class="max-w-5xl mx-auto px-4 mt-8">
    <div class="bg-white/80 backdrop-blur rounded-2xl p-6 sticker">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <h2 class="text-xl font-bold text-sky-700">ì›¹ì‚¬ì´íŠ¸ ëª¨ìŒ</h2>
        <div class="inline-flex rounded-xl overflow-hidden">
          <button id="tabEdu" class="px-3 py-1.5 text-sm font-semibold tab-active">ì¸ê°• ì›¹ì‚¬ì´íŠ¸</button>
          <button id="tabOfficial" class="px-3 py-1.5 text-sm font-semibold tab-inactive">ê³µì‹Â·í•„ìˆ˜ ì‚¬ì´íŠ¸</button>
        </div>
      </div>

      <div id="paneEdu" class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-3">
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://www.namucpa.com" target="_blank" rel="noopener">ë‚˜ë¬´ê²½ì˜ ì•„ì¹´ë°ë¯¸ â†—</a>
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://www.uricpa.com" target="_blank" rel="noopener">ìš°ë¦¬ê²½ì˜ ì•„ì¹´ë°ë¯¸ â†—</a>
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://www.smartcpa.kr" target="_blank" rel="noopener">ìŠ¤ë§ˆíŠ¸ê²½ì˜ ì•„ì¹´ë°ë¯¸ â†—</a>
      </div>

      <div id="paneOfficial" class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-3 hidden">
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://cpa.fss.or.kr" target="_blank" rel="noopener">ê¸ˆìœµê°ë…ì› CPA â†—</a>
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://www.kicpa.or.kr" target="_blank" rel="noopener">KICPA â†—</a>
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://www.kasb.or.kr" target="_blank" rel="noopener">KASB â†—</a>
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://dart.fss.or.kr" target="_blank" rel="noopener">DART â†—</a>
        <a class="block rounded-xl p-4 bg-sky-50 border border-sky-100 hover:shadow" href="https://www.fsc.go.kr" target="_blank" rel="noopener">ê¸ˆìœµìœ„ì›íšŒ â†—</a>
      </div>
    </div>
  </section>

  <!-- ë°©ëª…ë¡ -->
  <section class="max-w-5xl mx-auto px-4 mt-8 mb-12">
    <div class="bg-white/80 backdrop-blur rounded-2xl p-6 sticker">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold text-sky-700">ì¹œêµ¬ë“¤ì˜ í¸ì§€ ë°©ëª…ë¡</h2>
        <span id="modeLabel" class="text-xs text-slate-500">ë¡œì»¬ ì €ì¥</span>
      </div>
      <form id="guestForm" class="mt-4 grid sm:grid-cols-6 gap-3">
        <input id="guestName" class="sm:col-span-2 rounded-xl border-slate-200 focus:border-sky-400 focus:ring-sky-400" placeholder="ì´ë¦„(ë˜ëŠ” ì´ëª¨ì§€)" maxlength="20" required />
        <input id="guestMsg" class="sm:col-span-3 rounded-xl border-slate-200 focus:border-sky-400 focus:ring-sky-400" placeholder="í•œ ì¤„ ì‘ì›(ìµœëŒ€ 120ì)" maxlength="120" required />
        <button class="sm:col-span-1 rounded-xl bg-sky-600 text-white font-semibold hover:bg-sky-700">ë‚¨ê¸°ê¸°</button>
      </form>
      <ul id="guestList" class="mt-4 space-y-3"></ul>
    </div>
  </section>

  <footer class="text-center text-xs text-slate-500 pb-10">Made with ğŸ’™ for Nahyunâ€™s One-Shot CPA</footer>

  <script>
    /* ===== ë‚ ì§œ ê³ ì • ===== */
    const START_FIXED   = new Date('2024-03-01T00:00:00+09:00');
    const EXAM_1        = new Date('2026-03-01T00:00:00+09:00');
    const EXAM_2_START  = new Date('2026-06-27T00:00:00+09:00');

    /* ===== ìœ í‹¸ ===== */
    const clamp=(n,min,max)=>Math.min(Math.max(n,min),max);
    const dayDiff=(a,b)=>Math.ceil((b-a)/86400000);
    const $=s=>document.querySelector(s);

    /* ===== ëª¨ë“œ/ì„œë²„ ì„¤ì • ===== */
    const modeSel = $('#modeSel'), serverRow = $('#serverRow'), serverUrl = $('#serverUrl'), modeLabel = $('#modeLabel');
    function loadSettings(){
      const s = JSON.parse(localStorage.getItem('nahyun_settings')||'{}');
      modeSel.value = s.mode || 'local';
      serverUrl.value = s.server || 'http://localhost:3000';
      serverRow.classList.toggle('ghost', modeSel.value!=='server');
      modeLabel.textContent = (modeSel.value==='server'?'ì„œë²„ ê³µìœ  ì €ì¥':'ë¡œì»¬ ì €ì¥');
    }
    function saveSettings(){
      const s = { mode: modeSel.value, server: serverUrl.value };
      localStorage.setItem('nahyun_settings', JSON.stringify(s));
      serverRow.classList.toggle('ghost', modeSel.value!=='server');
      modeLabel.textContent = (modeSel.value==='server'?'ì„œë²„ ê³µìœ  ì €ì¥':'ë¡œì»¬ ì €ì¥');
    }
    modeSel.addEventListener('change', ()=>{ saveSettings(); loadMessages(); });
    serverUrl.addEventListener('change', ()=>{ saveSettings(); loadMessages(); });

    /* ===== 1ì°¨ í•©ê²© ìŠ¤ìœ„ì¹˜ ===== */
    const passed1El = $('#passed1');
    function loadState(){ return { passed1: localStorage.getItem('nahyun_passed1')==='1' }; }
    function saveState(st){ localStorage.setItem('nahyun_passed1', st.passed1?'1':'0'); }

    /* ===== D-Day ===== */
    function renderDday(){
      const now=new Date();
      const left1=Math.max(0, dayDiff(now, EXAM_1));
      const left2=Math.max(0, dayDiff(now, EXAM_2_START));
      $('#dday1').textContent = left1===0?'D-DAY':`D-${left1}`;
      $('#left1').textContent = `ë‚¨ì€: ${left1}ì¼`;
      $('#dday2').textContent = left2===0?'D-DAY':`D-${left2}`;
      $('#left2').textContent = `ë‚¨ì€: ${left2}ì¼`;
      const hero=document.querySelector('section .sticker');
      (left1<=30||left2<=30)? hero.classList.add('wiggle') : hero.classList.remove('wiggle');
    }

    /* ===== ë‚¨ì€ ë¹„ìœ¨ ===== */
    function renderProgress(){
      const st=loadState();
      const active= st.passed1? EXAM_2_START : EXAM_1;
      $('#activeExamLabel').textContent = `CPA ${st.passed1? '2ì°¨':'1ì°¨'}`;
      const now=new Date();
      const total= Math.max(0, active-START_FIXED);
      const left = Math.max(0, active-now);
      const pctLeft = total>0 ? (left/total)*100 : 0;
      const C = 2*Math.PI*50;
      $('#progressArc').setAttribute('stroke-dasharray', `${C*clamp(pctLeft,0,100)/100} ${C}`);
      $('#percentText').textContent = `${Math.round(pctLeft)}%`;
      $('#daysLeftText').textContent = `ë‚¨ì€ ${Math.ceil(left/86400000)}ì¼`;
    }

    /* ===== ì˜¤ëŠ˜ì˜ ì‘ì›: cheers.json + ë± ===== */
    const CHEER_DB_URL = './cheers.json'; // index.htmlê³¼ ê°™ì€ í´ë”
    const todayKey = ()=> new Date().toISOString().slice(0,10);

    function readLS(key,fallback){ try{ return JSON.parse(localStorage.getItem(key) ?? JSON.stringify(fallback)); }catch{ return fallback; } }
    function writeLS(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

    // ìºì‹œ ìš°íšŒ í¬í•¨ (ì„œë²„ì—ì„œ ìµœì‹  íŒŒì¼ ê°•ì œ ë¡œë”©)
    async function loadCheerDB(){
      const r = await fetch(`${CHEER_DB_URL}?t=${Date.now()}`, { cache:'no-store' });
      if(!r.ok) throw new Error('cheers.json ë¡œë“œ ì‹¤íŒ¨');
      return await r.json(); // [{id,category,text}, ...]
    }

    function ensureDeck(size){
      const raw = readLS('cheer.deck', null);
      const pos = Number(localStorage.getItem('cheer.deck_pos')||'0');
      if (Array.isArray(raw) && raw.length===size) return { deck: raw, pos: isNaN(pos)?0:pos };
      // ìƒˆ ë±(0..size-1) ì…”í”Œ
      const deck=[...Array(size).keys()];
      for(let i=size-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }
      writeLS('cheer.deck', deck); localStorage.setItem('cheer.deck_pos','0');
      return { deck, pos:0 };
    }
    function saveDeck(deck,pos){ writeLS('cheer.deck', deck); localStorage.setItem('cheer.deck_pos', String(pos)); }

    function pickCheer(db, {forceNewToday=false}={}){
      const k = todayKey();
      const cached = readLS('cheer.today', null);
      if(!forceNewToday && cached && cached.date===k) return cached.item;

      // ì¹´í…Œê³ ë¦¬ ë²ˆê°ˆì•„ ì“°ê¸°(ì§ìˆ˜ì¼ cheer, í™€ìˆ˜ì¼ growth)
      const prefer = (new Date().getDate()%2===0)? 'cheer':'growth';

      let {deck,pos} = ensureDeck(db.length);
      if(pos>=deck.length){ // í•œ ë°”í€´ ë‹¤ ì¼ìœ¼ë©´ ì„ê³  ì²˜ìŒë¶€í„°
        for(let i=deck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }
        pos=0;
      }

      // ì„ í˜¸ ì¹´í…Œê³ ë¦¬ë¥¼ ë§Œì¡±í•˜ëŠ” ë‹¤ìŒ ì•„ì´í…œ ì°¾ê¸°(ìµœëŒ€ deck ê¸¸ì´ë§Œí¼ íƒìƒ‰)
      let chosenIndex = null;
      for(let step=0; step<deck.length; step++){
        const idx = deck[(pos+step)%deck.length];
        if(db[idx]?.category===prefer){ chosenIndex=idx; pos=(pos+step+1)%deck.length; break; }
      }
      if(chosenIndex===null){ chosenIndex=deck[pos]; pos=(pos+1)%deck.length; }

      saveDeck(deck,pos);
      const item = db[chosenIndex];
      writeLS('cheer.today', { date:k, item });
      return item;
    }

    async function renderCheer({forceNewToday=false}={}){
      const card = $('#cheerCard');
      card.textContent = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';
      try{
        const db = await loadCheerDB();
        const item = pickCheer(db, {forceNewToday});
        card.textContent = item.text;
      }catch(e){
        const fallback = [
          'ì˜¤ëŠ˜ë„ í•œ ë¬¸ì œ ë”! ğŸ’™',
          'ì‘ì€ ê¾¸ì¤€í•¨ì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤ âœ¨',
          'ì§‘ì¤‘ 25ë¶„, íœ´ì‹ 5ë¶„ â±ï¸',
          'ê¸°ì¶œì€ ìµœê³ ì˜ ìŠ¤ìŠ¹ ğŸ“˜'
        ];
        card.textContent = fallback[Math.floor(Math.random()*fallback.length)];
        console.warn(e);
      }
    }

    // ê°™ì€ ë‚ ì´ë©´ ê°™ì€ ë¬¸êµ¬ ìœ ì§€
    $('#refreshCheer').addEventListener('click', ()=>renderCheer());

    // ì˜¤ëŠ˜ ê°•ì œ ì¬ì¶”ì²¨: ì˜¤ëŠ˜ ìºì‹œ ì‚­ì œ + ë± í¬ì¸í„° í•œ ì¹¸ ì´ë™(ì—°ì† ì¤‘ë³µ ë°©ì§€)
    $('#forceNewCheer').addEventListener('click', ()=>{
      localStorage.removeItem('cheer.today');
      try{
        const deck = JSON.parse(localStorage.getItem('cheer.deck')||'[]');
        let pos = parseInt(localStorage.getItem('cheer.deck_pos')||'0',10);
        if (deck.length) { pos = (pos+1) % deck.length; localStorage.setItem('cheer.deck_pos', String(pos)); }
      }catch{}
      renderCheer({forceNewToday:true});
    });

    /* ===== íƒ­ ===== */
    const tabEdu=$('#tabEdu'), tabOfficial=$('#tabOfficial'), paneEdu=$('#paneEdu'), paneOfficial=$('#paneOfficial');
    function activateTab(which){
      const edu = which==='edu';
      paneEdu.classList.toggle('hidden', !edu);
      paneOfficial.classList.toggle('hidden', edu);
      tabEdu.classList.toggle('tab-active', edu); tabEdu.classList.toggle('tab-inactive', !edu);
      tabOfficial.classList.toggle('tab-active', !edu); tabOfficial.classList.toggle('tab-inactive', edu);
    }
    tabEdu.addEventListener('click', ()=>activateTab('edu'));
    tabOfficial.addEventListener('click', ()=>activateTab('official'));

    /* ===== ë°©ëª…ë¡ (ë¡œì»¬/ì„œë²„) ===== */
    function escapeHTML(s){return (s+'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));}

    async function loadMessages(){
      const s = JSON.parse(localStorage.getItem('nahyun_settings')||'{}');
      if(s.mode==='server'){
        try{
          const r = await fetch((s.server||'').replace(/\/$/,'') + '/api/messages');
          if(!r.ok) throw 0;
          const data = await r.json();
          renderGuestbookList(data.messages||[]);
          return;
        }catch(e){
          // ì„œë²„ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ë¡œ í´ë°±
        }
      }
      const items = JSON.parse(localStorage.getItem('nahyun_guestbook')||'[]');
      renderGuestbookList(items);
    }

    function renderGuestbookList(items){
      const list = (items||[]).slice().sort((a,b)=> (b.ts||b.createdAt) - (a.ts||a.createdAt)).slice(0,50);
      const ul = $('#guestList'); ul.innerHTML='';
      if(list.length===0){ ul.innerHTML = '<li class="text-sm text-slate-500">ì²« ì‘ì›ì„ ë‚¨ê²¨ë³´ì„¸ìš” ğŸ’™</li>'; return; }
      for(const it of list){
        const li=document.createElement('li'); li.className='p-3 rounded-xl bg-sky-50 border border-sky-100';
        const when=new Date(it.ts||it.createdAt);
        li.innerHTML=`<div class="text-sm"><span class="font-semibold text-sky-700">${escapeHTML(it.name)}</span> Â· <span class="text-slate-500">${when.toLocaleString()}</span></div><div class="text-slate-700">${escapeHTML(it.text||it.msg)}</div>`;
        ul.appendChild(li);
      }
    }

    async function submitMessage(name, text){
      const s = JSON.parse(localStorage.getItem('nahyun_settings')||'{}');
      if(s.mode==='server'){
        const url = (s.server||'').replace(/\/$/,'') + '/api/messages';
        const r = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name, text }) });
        if(!r.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
        const data = await r.json(); renderGuestbookList(data.messages||[]); return;
      }
      // ë¡œì»¬
      const items = JSON.parse(localStorage.getItem('nahyun_guestbook')||'[]');
      items.push({ name, text, ts: Date.now() });
      localStorage.setItem('nahyun_guestbook', JSON.stringify(items));
      renderGuestbookList(items);
    }

    $('#guestForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const name=$('#guestName').value.trim(), text=$('#guestMsg').value.trim();
      if(!name||!text) return;
      try{ await submitMessage(name,text); $('#guestMsg').value=''; }catch(err){ alert('ì €ì¥ ì‹¤íŒ¨: '+err.message); }
    });

    /* ===== ì´ˆê¸°í™” ===== */
    function boot(){
      loadSettings();
      const st=loadState(); passed1El.checked=st.passed1;
      activateTab('edu');
      renderDday(); renderProgress(); renderCheer(); loadMessages();
      setInterval(()=>{ renderDday(); renderProgress(); }, 60000);
    }
    passed1El.addEventListener('change', ()=>{ const st=loadState(); st.passed1=passed1El.checked; saveState(st); renderProgress(); renderCheer(); });
    boot();
  </script>
</body>
</html>
